# üìã –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –°—É—â–Ω–æ—Å—Ç—å Assignment

## üéØ –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

**Assignment** - –µ–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–ª–∞–Ω–æ–≤—ã—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π –±—Ä–∏–≥–∞–¥–∏—Ä–æ–≤ –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –Ω–∞ –∑–∞—è–≤–∫–∏.

## üìä –¢–∏–ø—ã –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π

### 1. üîß `brigadier_schedule` - –ü–ª–∞–Ω–æ–≤—ã–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –±—Ä–∏–≥–∞–¥–∏—Ä–æ–≤
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–ª–∞–Ω–æ–≤—ã–π –≤—ã—Ö–æ–¥ –±—Ä–∏–≥–∞–¥–∏—Ä–æ–≤ –≤ —Å–º–µ–Ω—É –ø–æ –≥—Ä–∞—Ñ–∏–∫—É
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –°–æ–∑–¥–∞–µ—Ç—Å—è –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–æ–º –∑–∞—Ä–∞–Ω–µ–µ
- –¢—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –±—Ä–∏–≥–∞–¥–∏—Ä–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Å–º–µ–Ω—É –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏
- –ò–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

**–ü–æ–ª—è:**
- `work_request_id` = NULL
- `assignment_number` = –∑–∞–ø–æ–ª–Ω–µ–Ω (–∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è)
- `shift_id` = –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 2. üìã `work_request` - –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –∑–∞—è–≤–∫–∏  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞—è–≤–∫–∏
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –°–æ–∑–¥–∞–µ—Ç—Å—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–º –ø—Ä–∏ –∫–æ–º–ø–ª–µ–∫—Ç–æ–≤–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –°–º–µ–Ω–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é/—á–µ—Ä–µ–∑ API

**–ü–æ–ª—è:**
- `work_request_id` = –∑–∞–ø–æ–ª–Ω–µ–Ω
- `assignment_number` = NULL
- `shift_id` = NULL (—Å–º–µ–Ω–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ)

### 3. üë• `mass_personnel` - –ú–∞—Å—Å–æ–≤—ã–π –ø–µ—Ä—Å–æ–Ω–∞–ª
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ (–Ω–µ–ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ) –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:** (–∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è)

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è:
```php
// –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
'id'                    // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
'assignment_type'       // –¢–∏–ø –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: brigadier_schedule, work_request, mass_personnel
'user_id'              // –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å/–±—Ä–∏–≥–∞–¥–∏—Ä)
'work_request_id'      // –°—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞—è–≤–∫—É (NULL –¥–ª—è –±—Ä–∏–≥–∞–¥–∏—Ä–æ–≤)

// –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
'planned_date'         // –ü–ª–∞–Ω–∏—Ä—É–µ–º–∞—è –¥–∞—Ç–∞ —Ä–∞–±–æ—Ç—ã
'planned_start_time'   // –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã
'planned_duration_hours' // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–º–µ–Ω—ã (—á–∞—Å–æ–≤)

// –ê–¥—Ä–µ—Å —Ä–∞–±–æ—Ç—ã
'planned_address_id'   // –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å
'planned_custom_address' // –ù–µ–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å  
'is_custom_planned_address' // –§–ª–∞–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–µ–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞

// –°—Ç–∞—Ç—É—Å –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
'status'              // pending, confirmed, rejected, completed
'confirmed_at'        // –î–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
'rejected_at'         // –î–∞—Ç–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
'rejection_reason'    // –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞

// –°–≤—è–∑–∏
'shift_id'            // –°–æ–∑–¥–∞–Ω–Ω–∞—è —Å–º–µ–Ω–∞ (–¥–ª—è –±—Ä–∏–≥–∞–¥–∏—Ä–æ–≤)
'assignment_number'   // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–¥–ª—è –±—Ä–∏–≥–∞–¥–∏—Ä–æ–≤)

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
'role_in_shift'       // executor, brigadier
'source'              // dispatcher, initiator
'assignment_comment'  // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é
```

## üîÑ Workflow

### –î–ª—è –±—Ä–∏–≥–∞–¥–∏—Ä–æ–≤ (brigadier_schedule):

[–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ] 
    ‚Üí [–°—Ç–∞—Ç—É—Å: pending]
    ‚Üí [–ë—Ä–∏–≥–∞–¥–∏—Ä –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç] 
    ‚Üí [–°—Ç–∞—Ç—É—Å: confirmed] 
    ‚Üí [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–º–µ–Ω–∞]
    ‚Üí [Shift —Å–æ–∑–¥–∞–Ω–∞ —Å–æ assignment_number]

### –î–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π (work_request):

[–î–∏—Å–ø–µ—Ç—á–µ—Ä —Å–æ–∑–¥–∞–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ]
    ‚Üí [–°—Ç–∞—Ç—É—Å: confirmed]
    ‚Üí [–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –≤—ã—Ö–æ–¥–∏—Ç –≤ —Å–º–µ–Ω—É —á–µ—Ä–µ–∑ API]
    ‚Üí [Shift —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é —Å request_id]

## üõ†Ô∏è API Methods

### –û—Å–Ω–æ–≤–Ω—ã–µ endpoints:

// CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
GET    /api/assignments           // –°–ø–∏—Å–æ–∫ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π
POST   /api/assignments           // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
GET    /api/assignments/{id}      // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
PUT    /api/assignments/{id}      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
DELETE /api/assignments/{id}      // –£–¥–∞–ª–µ–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

// –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
POST   /api/assignments/{id}/confirm  // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
POST   /api/assignments/{id}/reject   // –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
GET    /api/my/assignments           // –ú–æ–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

### Key Methods –≤ –º–æ–¥–µ–ª–∏:
```
// –°—Ç–∞—Ç—É—Å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
$assignment->confirm()           // –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
$assignment->reject($reason)    // –û—Ç–∫–ª–æ–Ω–∏—Ç—å —Å –ø—Ä–∏—á–∏–Ω–æ–π
$assignment->complete()          // –ó–∞–≤–µ—Ä—à–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

// –ü—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
$assignment->isPending()         // –û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
$assignment->isConfirmed()       // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ
$assignment->isBrigadierSchedule() // –Ø–≤–ª—è–µ—Ç—Å—è –ø–ª–∞–Ω–æ–≤—ã–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º
$assignment->isWorkRequest()     // –Ø–≤–ª—è–µ—Ç—Å—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º –Ω–∞ –∑–∞—è–≤–∫—É

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ
$assignment->planned_end_time    // –†–∞—Å—á–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è
$assignment->full_planned_address // –ü–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å —Ä–∞–±–æ—Ç—ã
```

### üéØ Scopes –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

```
// –ü–æ —Ç–∏–ø—É –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
Assignment::brigadierSchedules()  // –¢–æ–ª—å–∫–æ –ø–ª–∞–Ω–æ–≤—ã–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
Assignment::workRequests()        // –¢–æ–ª—å–∫–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –∑–∞—è–≤–∫–∏

// –ü–æ —Å—Ç–∞—Ç—É—Å—É
Assignment::pending()             // –û–∂–∏–¥–∞—é—â–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
Assignment::confirmed()           // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ
Assignment::rejected()            // –û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ

// –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ
Assignment::active()              // –ê–∫—Ç–∏–≤–Ω—ã–µ (pending + confirmed)
Assignment::brigadierAssignments() // –ë—Ä–∏–≥–∞–¥–∏—Ä—ã (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π scope)
Assignment::executorAssignments()  // –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π scope)
```

## üîç Observer Logic

### AssignmentObserver –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç:

1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±—Ä–∏–≥–∞–¥–∏—Ä—Å–∫–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

2. –°–æ–∑–¥–∞–Ω–∏–µ —Å–º–µ–Ω—ã –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –±—Ä–∏–≥–∞–¥–∏—Ä—Å–∫–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞

## üí° Best Practices

### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π:
```
// –ë—Ä–∏–≥–∞–¥–∏—Ä—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
Assignment::create([
    'assignment_type' => 'brigadier_schedule',
    'user_id' => $brigadierId,
    'role_in_shift' => 'brigadier',
    // work_request_id –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å NULL
]);

// –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –∑–∞—è–≤–∫—É  
Assignment::create([
    'assignment_type' => 'work_request', 
    'user_id' => $executorId,
    'work_request_id' => $requestId,
    'role_in_shift' => 'executor',
]);
```

### –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏:
```
// –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã –º–æ–¥–µ–ª–∏
$assignment->confirm();
$assignment->reject('–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞');

// –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - –ø—Ä—è–º–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
$assignment->update(['status' => 'confirmed']);
```
## üö® –í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. –í–∞–ª–∏–¥–∞—Ü–∏—è: –î–ª—è work_request –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω work_request_id, –¥–ª—è brigadier_schedule –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å NULL

2. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è: –°–º–µ–Ω–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö brigadier_schedule –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π

3. –ù—É–º–µ—Ä–∞—Ü–∏—è: –ù–æ–º–µ—Ä–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –±—Ä–∏–≥–∞–¥–∏—Ä–æ–≤

4. –°—Ç–∞—Ç—É—Å—ã: –î–µ–π—Å—Ç–≤–∏—è "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"/"–û—Ç–∫–ª–æ–Ω–∏—Ç—å" –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ pending