# üìã WorkRequest - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∑–∞—è–≤–∫–∏

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–û—Å–Ω–æ–≤–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã - –∑–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç —Å –ø–æ–ª–Ω–æ–π –ø—Ä–æ–µ–∫—Ç–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏:
```php
// –ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑–∞—Ç—å:
'initiator_id', 'workers_count', 'estimated_shift_duration', 'work_date'

// –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –ø–æ–∑–∂–µ:
'personnel_type' // –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–º –ø—Ä–∏ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏
'brigadier_id'   // –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —ç—Ç–∞–ø –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
'category_id'    // –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
'contractor_id'  // –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –º–∞—Å—Å–æ–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞
```

## –í—Å–µ –ø–æ–ª—è –º–æ–¥–µ–ª–∏:
```php
protected $fillable = [
    // –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
    'request_number', 'status',
    
    // –£—á–∞—Å—Ç–Ω–∏–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞
    'initiator_id', 'brigadier_id', 'brigadier_manual', 'dispatcher_id', 'contractor_id',
    
    // –ü—Ä–æ–µ–∫—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
    'project_id', 'purpose_id', 'category_id', 'work_type_id',
    
    // –ü–µ—Ä—Å–æ–Ω–∞–ª (personnel_type –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–º –ø–æ–∑–∂–µ)
    'personnel_type', 'workers_count', 'mass_personnel_names', 'total_worked_hours',
    
    // –í—Ä–µ–º—è –∏ –∞–¥—Ä–µ—Å–∞
    'work_date', 'start_time', 'estimated_shift_duration', // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
    'address_id', 'custom_address', 'is_custom_address',
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
    'additional_info',
    
    // –¢–∞–π–º—Å—Ç–∞–º–ø—ã –ø—Ä–æ—Ü–µ—Å—Å–∞
    'published_at', 'staffed_at', 'completed_at'
];
```

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∏ —Å—Ç–∞—Ç—É—Å—ã

### –°—Ç–∞—Ç—É—Å—ã –∑–∞—è–≤–∫–∏ (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–∞–ø–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è):

* draft ‚Üí –ß–µ—Ä–Ω–æ–≤–∏–∫ (—Å–æ–∑–¥–∞–Ω–∞ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–æ–º)

* pending_brigadier_confirmation ‚Üí –û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –±—Ä–∏–≥–∞–¥–∏—Ä–∞ ‚≠ê –ù–û–í–´–ô

* published ‚Üí –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞ (–±—Ä–∏–≥–∞–¥–∏—Ä –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω)

* in_progress ‚Üí –í–∑—è—Ç–∞ –≤ —Ä–∞–±–æ—Ç—É (–∫–æ–º–ø–ª–µ–∫—Ç—É–µ—Ç—Å—è)

* closed ‚Üí –ó–∞—è–≤–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞ (—É–∫–æ–º–ø–ª–µ–∫—Ç–æ–≤–∞–Ω–∞)

* working ‚Üí –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç

* completed ‚Üí –ó–∞—è–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

* cancelled ‚Üí –ó–∞—è–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞

### –¢–∏–ø—ã –ø–µ—Ä—Å–æ–Ω–∞–ª–∞ (–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–º):

* personalized ‚Üí –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏)

* mass ‚Üí –ú–∞—Å—Å–æ–≤—ã–π (–æ–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–ª –ø–æ–¥—Ä—è–¥—á–∏–∫–∞)

### Workflow —Å —ç—Ç–∞–ø–æ–º –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:

* –°–æ–∑–¥–∞–Ω–∏–µ ‚Üí draft (–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–µ—Ç –∑–∞—è–≤–∫—É)

* –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±—Ä–∏–≥–∞–¥–∏—Ä–∞ ‚Üí pending_brigadier_confirmation (–û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)

* –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–∏–≥–∞–¥–∏—Ä–∞ ‚Üí published (–ü–µ—Ä–µ–¥–∞—á–∞ –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É)

* –ö–æ–º–ø–ª–µ–∫—Ç–æ–≤–∞–Ω–∏–µ ‚Üí in_progress (–î–∏—Å–ø–µ—Ç—á–µ—Ä –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π)

* –ó–∞–∫—Ä—ã—Ç–∏–µ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏–∏ ‚Üí closed (–ó–∞—è–≤–∫–∞ —É–∫–æ–º–ø–ª–µ–∫—Ç–æ–≤–∞–Ω–∞)

* –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç ‚Üí working (–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç)

* –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ ‚Üí completed (–í—Å–µ —Å–º–µ–Ω—ã –∑–∞–∫—Ä—ã—Ç—ã –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã)

## üéØ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞ –∑–∞—è–≤–∫–∏:
```php
public function generateRequestNumber()
{
    if ($this->personnel_type === 'mass' && $this->contractor) {
        // –ü–æ–¥—Ä—è–¥—á–∏–∫: [–∫–æ–¥_–ø–æ–¥—Ä—è–¥—á–∏–∫–∞]-[ID]/[–≥–æ–¥]
        return $this->contractor->contractor_code . '-' . $this->id . '/' . now()->year;
    } else {
        // –ù–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª: [–ø—Ä–µ—Ñ–∏–∫—Å_–∫–∞—Ç–µ–≥–æ—Ä–∏–∏]-[ID]/[–≥–æ–¥]
        $prefix = $this->category?->prefix ?: 'WR';
        return $prefix . '-' . $this->id . '/' . now()->year;
    }
}
```

### –≠—Ç–∞–ø –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è - –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±—Ä–∏–≥–∞–¥–∏—Ä–∞:
```php
public function assignBrigadier($brigadierId, $workDate)
{
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
    $hasConflict = BrigadierAssignment::where('brigadier_id', $brigadierId)
        ->where('status', 'active')
        ->whereHas('assignment_dates', function ($query) use ($workDate) {
            $query->where('work_date', $workDate);
        })
        ->exists();

    if ($hasConflict) {
        throw new \Exception('–ë—Ä–∏–≥–∞–¥–∏—Ä —É–∂–µ –∑–∞–Ω—è—Ç –Ω–∞ —ç—Ç—É –¥–∞—Ç—É');
    }

    $this->update([
        'brigadier_id' => $brigadierId,
        'status' => 'pending_brigadier_confirmation'
    ]);
}
```

## üîó –°–∏—Å—Ç–µ–º–∞ —Å–≤—è–∑–µ–π

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–≤—è–∑–∏:
```php
public function initiator() { return $this->belongsTo(User::class, 'initiator_id'); }
public function brigadier() { return $this->belongsTo(User::class, 'brigadier_id'); }
public function dispatcher() { return $this->belongsTo(User::class, 'dispatcher_id'); }
public function category() { return $this->belongsTo(Category::class); }
public function workType() { return $this->belongsTo(WorkType::class); }
public function project() { return $this->belongsTo(Project::class); }
public function purpose() { return $this->belongsTo(Purpose::class); }
public function address() { return $this->belongsTo(Address::class); }
public function contractor() { return $this->belongsTo(Contractor::class); }
```

### –†–∞–±–æ—á–∏–µ —Å–≤—è–∑–∏:
```php
public function shifts() { return $this->hasMany(Shift::class, 'request_id'); }
public function assignments() { return $this->hasMany(Assignment::class, 'request_id'); }
public function massPersonnelReports() { return $this->hasMany(MassPersonnelReport::class, 'request_id'); }
```

## üí° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç—Ç–∞–ø–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±—Ä–∏–≥–∞–¥–∏—Ä–∞:

* –ë—Ä–∏–≥–∞–¥–∏—Ä–æ–º –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±–æ–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (—Ä–æ–ª—å executor)

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø–æ –¥–∞—Ç–∞–º —á–µ—Ä–µ–∑ BrigadierAssignment

* –°—Ç–∞—Ç—É—Å pending_brigadier_confirmation –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º

* –ü—Ä–∏ –æ—Ç–∫–∞–∑–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è - —Å–∏—Å—Ç–µ–º–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç –µ–≥–æ –Ω–∞ —ç—Ç—É –¥–∞—Ç—É

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞:

* –ó–∞—è–≤–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –¢–û–õ–¨–ö–û –Ω–∞ –Ω–∞—à–∏—Ö –ò–õ–ò –Ω–∞ –ø–æ–¥—Ä—è–¥—á–∏–∫–∞

* –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–ª - –û–î–ù–ê –∫–∞—Ç–µ–≥–æ—Ä–∏—è

* –û–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–ª - –û–î–ù–ê —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å

* –ë—Ä–∏–≥–∞–¥–∏—Ä (–Ω–∞—à/–ø–æ–¥—Ä—è–¥—á–∏–∫/—Ä—É—á–Ω–æ–π) –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ç–∏–ø –ø–µ—Ä—Å–æ–Ω–∞–ª–∞

### –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏:

* estimated_shift_duration - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (–∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä –∑–Ω–∞–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

* personnel_type - nullable (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–æ–º –ø–æ–∑–∂–µ)

* work_date - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
